--- a/qmake/Makefile.unix	2013-06-06 15:40:18.087304858 +0200
+++ b/qmake/Makefile.unix	2013-06-06 15:43:08.887308620 +0200
@@ -85,8 +85,8 @@
 CPPFLAGS = -g $(EXTRA_CPPFLAGS) \
 	   -I$(QMKSRC) -I$(QMKLIBSRC) -I$(QMKSRC)/generators -I$(QMKSRC)/generators/unix -I$(QMKSRC)/generators/win32 \
 	   -I$(QMKSRC)/generators/mac -I$(QMKSRC)/generators/integrity \
-	   -I$(INC_PATH) -I$(INC_PATH)/QtCore \
-	   -I$(INC_PATH)/QtCore/$(QT_VERSION) -I$(INC_PATH)/QtCore/$(QT_VERSION)/QtCore \
+	   -I$(BUILD_PATH)/include -I$(BUILD_PATH)/include/QtCore \
+	   -I$(BUILD_PATH)/include/QtCore/$(QT_VERSION) -I$(BUILD_PATH)/include/QtCore/$(QT_VERSION)/QtCore \
 	   -I$(BUILD_PATH)/src/corelib/global -DHAVE_QCONFIG_CPP \
 	   -I$(QMAKESPEC) \
 	   -I$(SOURCE_PATH)/tools/shared \
--- a/qmake/Makefile.win32	2013-06-06 15:40:28.327304862 +0200
+++ b/qmake/Makefile.win32	2013-06-06 15:43:15.543303955 +0200
@@ -34,7 +34,7 @@
               -W3 -nologo -O1 \
               $(CFLAGS_EXTRA) \
               -I$(QMKSRC) -I$(QMKSRC)\library -I$(QMKSRC)\generators -I$(QMKSRC)\generators\unix -I$(QMKSRC)\generators\win32 -I$(QMKSRC)\generators\mac -I$(QMKSRC)\generators\integrity \
-              -I$(INC_PATH) -I$(INC_PATH)\QtCore -I$(INC_PATH)\QtCore\$(QT_VERSION) -I$(INC_PATH)\QtCore\$(QT_VERSION)\QtCore \
+              -I$(BUILD_PATH)\include -I$(BUILD_PATH)\include\QtCore -I$(BUILD_PATH)\include\QtCore\$(QT_VERSION) -I$(BUILD_PATH)\include\QtCore\$(QT_VERSION)\QtCore \
               -I$(BUILD_PATH)\src\corelib\global -DHAVE_QCONFIG_CPP \
               -I$(SOURCE_PATH)\mkspecs\$(QMAKESPEC)  \
               -I$(SOURCE_PATH)\tools\shared \
--- a/configure	2013-06-06 15:38:33.431303814 +0200
+++ b/configure	2013-06-06 15:42:28.359304279 +0200
@@ -2389,6 +2389,13 @@
 if [ "$OPT_SHADOW" = "yes" ]; then
     echo "Preparing build tree..."
 
+    if [ -z "$PERL" ]; then
+        echo
+        echo "You need perl in your PATH to make a shadow build."
+        echo "Cannot proceed."
+        exit 1
+    fi
+
     [ -d "$outpath/bin" ] || mkdir -p "$outpath/bin"
 
     # save a pre-existing mkspecs/modules dir
@@ -3888,14 +3895,7 @@
 # -----------------------------------------------------------------------------
 
 # symlink includes
-if [ -e "$relpath/.git" ]; then
-    if [ -z "$PERL" ]; then
-        echo
-        echo "You need perl in your PATH to make a build from GIT."
-        echo "Cannot proceed."
-        exit 1
-    fi
-
+if [ -n "$PERL" ] && [ -x "$relpath/bin/syncqt.pl" ]; then
     "$relpath/bin/syncqt.pl" -minimal -module QtCore "$relpath" || exit 1
 fi
 
@@ -4028,11 +4028,6 @@
 
         echo "BUILD_PATH = $adjoutpath" >> "$mkfile"
         echo "SOURCE_PATH = $adjrelpath" >> "$mkfile"
-        if [ -e "$relpath/.git" ]; then
-            echo 'INC_PATH = $(BUILD_PATH)/include' >> "$mkfile"
-        else
-            echo 'INC_PATH = $(SOURCE_PATH)/include' >> "$mkfile"
-        fi
         echo "QMAKESPEC = $adjqmakespec" >> "$mkfile"
         echo "QT_VERSION = $QT_VERSION" >> "$mkfile"
         echo "EXTRA_CFLAGS = $EXTRA_CFLAGS" >> "$mkfile"
--- a/tools/configure/configureapp.cpp	2013-06-06 15:40:46.735304471 +0200
+++ b/tools/configure/configureapp.cpp	2013-06-06 15:43:33.159302436 +0200
@@ -1987,7 +1987,7 @@
         return "auto";
 
     if (option == "SYNCQT"
-        && (!QFile::exists(sourcePath + "/.git")))
+        && (!QFile::exists(sourcePath + "/bin/syncqt.pl")))
         return "no";
 
     // Do not actually build the examples in production builds with -prefix, unless requested
@@ -3810,10 +3810,7 @@
                 QTextStream stream(&out);
                 stream << "#AutoGenerated by configure.exe" << endl
                     << "BUILD_PATH = " << QDir::toNativeSeparators(buildPath) << endl
-                    << "SOURCE_PATH = " << QDir::toNativeSeparators(sourcePath) << endl
-                    << "INC_PATH = " << QDir::toNativeSeparators(
-                           (QFile::exists(sourcePath + "/.git") ? buildPath : sourcePath)
-                           + "/include") << endl;
+                    << "SOURCE_PATH = " << QDir::toNativeSeparators(sourcePath) << endl;
                 stream << "QT_VERSION = " << dictionary["VERSION"] << endl;
                 if (dictionary[ "QMAKESPEC" ] == QString("win32-g++")) {
                     stream << "QMAKESPEC = $(SOURCE_PATH)\\mkspecs\\win32-g++" << endl
--- a/mkspecs/features/qt_build_paths.prf	2013-06-06 15:38:56.895309796 +0200
+++ b/mkspecs/features/qt_build_paths.prf	2013-06-06 15:42:37.647303086 +0200
@@ -16,9 +16,6 @@
 isEmpty(MODULE_BASE_OUTDIR): MODULE_BASE_OUTDIR = $$shadowed($$MODULE_BASE_DIR)
 isEmpty(MODULE_QMAKE_OUTDIR): MODULE_QMAKE_OUTDIR = $$MODULE_BASE_OUTDIR
 
-exists($$MODULE_PROFILE_DIR/.git): \
-    CONFIG += git_build
-
 !prefix_build {
     QTDIR = $$[QT_HOST_PREFIX]
     # Permit modules to enforce being built outside QTDIR ...
--- a/mkspecs/features/qt_module_headers.prf	2013-06-06 15:39:18.687304206 +0200
+++ b/mkspecs/features/qt_module_headers.prf	2013-06-06 15:42:47.159302961 +0200
@@ -11,7 +11,7 @@
 
 load(qt_build_paths)
 
-!build_pass:git_build {
+!build_pass {
     qtPrepareTool(QMAKE_SYNCQT, syncqt)
     minimal_syncqt {
         QMAKE_SYNCQT += -minimal $$QMAKE_SYNCQT_OPTIONS
@@ -29,11 +29,7 @@
 minimal_syncqt: return()
 
 #load up the headers info
-git_build: \
-    INC_PATH = $$MODULE_BASE_OUTDIR
-else: \
-    INC_PATH = $$MODULE_BASE_DIR
-include($$INC_PATH/include/$$MODULE_INCNAME/headers.pri, "", true)
+include($$MODULE_BASE_OUTDIR/include/$$MODULE_INCNAME/headers.pri, "", true)
 
 autogen_warning = \
     "/* This file was generated by qmake with the info from <root>/$$relative_path($$_PRO_FILE_, $$MODULE_BASE_DIR). */"

